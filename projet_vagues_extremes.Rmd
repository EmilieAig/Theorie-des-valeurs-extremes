---
title: "Projet valeurs extrêmes"
author: "AIGOIN Emilie"
date: "2026-02-01"
output: html_document
---

```{r, warning=FALSE, message=FALSE}

# Chargement des packages 

library(ggplot2)
library(ggrepel)
library(gridExtra)
library(extRemes)  # Package pour les valeurs extrêmes
library(lubridate) # Pour manipuler les dates
library(dplyr)
library(evd)
library(ismev)
library(fExtremes)

```


```{r}

# Chargement des données

load("DonneesStations.RData")
load("DonneesVagues.RData")

```

```{r}

# Préparation des données avec une colonne pour la catégorie de station
buoysInfos_plot <- buoysInfos %>%
  mutate(categorie = case_when(
    indexStation == 1 ~ "Station SA",
    indexStation == 11 ~ "Station SB",
    indexStation == 8 ~ "Station SC",
    indexStation == 7 ~ "Station SD",

    TRUE ~ "Autres stations"
  ))

# Définition des couleurs
couleurs <- c(
  "Station SA" = "plum",
  "Station SB" = "lightcoral",
  "Station SC" = "lightblue",
  "Station SD" = "lightgreen",
  "Autres stations" = "darkblue"
)

```


```{r}

# Graphique pour la répartition des stations
carte_stations <- ggplot(buoysInfos_plot,
                         aes(x = lon, y = lat, color = categorie)) +
  geom_point(size = 4) +
  geom_text_repel(aes(label = indexStation), size = 3,
                  box.padding = 0.5, point.padding = 0.3,
                  color = "black",
                  show.legend = FALSE) +
  scale_color_manual(values = couleurs) +
  labs(title = "Localisation des 20 stations dans le golfe du Lion",
       x = "Longitude", y = "Latitude",
       color = "") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position = "bottom")

print(carte_stations)

```

```{r}

# Série temporelle de la station Lion (station 1)

dates <- as.POSIXct(donneesVague$date)
hauteurs_lion <- donneesVague$station1

# Graphique de la série temporelle complète
serie_lion <- ggplot(data.frame(date = dates, hauteur = hauteurs_lion), 
                     aes(x = date, y = hauteur)) +
  geom_line(color = "darkblue", linewidth = 0.3) +
  labs(title = "Hauteurs de vagues - Station Lion (1961-2012)",
       x = "Date", y = "Hauteur significative (m)") +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5)) 

print(serie_lion)

```

```{r}

# Zoom sur 2 années (2010-2011) pour observer les tendances saisonnières

dates_zoom <- dates >= as.POSIXct("2010-01-01") & dates < as.POSIXct("2012-01-01")
donnees_zoom <- data.frame(date = dates[dates_zoom], 
                           hauteur = hauteurs_lion[dates_zoom])

serie_lion_zoom <- ggplot(donnees_zoom, aes(x = date, y = hauteur)) +
  geom_line(color = "darkblue", linewidth = 0.5) +
  labs(title = "Hauteurs de vagues - Station Lion (2010-2011)",
       x = "Date", y = "Hauteur significative (m)") +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5)) 

print(serie_lion_zoom)

```

```{r}

# Statistiques descriptives pour la station Lion

cat("Nombre d'observations:", length(hauteurs_lion), "\n")
cat("Minimum:", min(hauteurs_lion, na.rm = TRUE), "m\n")
cat("Maximum:", max(hauteurs_lion, na.rm = TRUE), "m\n")
cat("Moyenne:", round(mean(hauteurs_lion, na.rm = TRUE), 3), "m\n")
cat("Médiane:", round(median(hauteurs_lion, na.rm = TRUE), 3), "m\n")
cat("Écart-type:", round(sd(hauteurs_lion, na.rm = TRUE), 3), "m\n")
cat("Nombre de valeurs manquantes:", sum(is.na(hauteurs_lion)), "\n")

```

```{r}

# Distribution des hauteurs de vagues

hist_lion <- ggplot(data.frame(hauteur = hauteurs_lion), aes(x = hauteur)) +
  geom_histogram(bins = 50, fill = "plum", color = "black", alpha = 0.7) +
  labs(title = "Distribution des hauteurs de vagues - Station Lion",
       x = "Hauteur significative (m)", y = "Fréquence") +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5)) 

print(hist_lion)

```

```{r}

# QQ plot

# Extraction des maxima mensuels
dates_df <- data.frame(
  date = dates,
  hauteur = hauteurs_lion,
  annee = year(dates),
  mois = month(dates)
)

maxima_mensuels <- aggregate(hauteur ~ annee + mois, 
                             data = dates_df, 
                             FUN = max)

# Ajustement GEV
fit_gev <- fevd(maxima_mensuels$hauteur, type = "GEV")

# QQ-plot
plot(fit_gev, 
     type = "qq",
     main = "QQ-plot - Station Lion",
     col = "darkblue")

```

```{r}

# Test de stationnarité : vérifier si les maxima changent dans le temps
plot(maxima_mensuels$hauteur, 
     type = "l",
     main = "Évolution des maxima mensuels dans le temps",
     xlab = "Indice temporel (mois)",
     ylab = "Hauteur maximale (m)", 
     col = "darkblue")
abline(h = mean(maxima_mensuels$hauteur), col = "red", lty = 2)

```


```{r}

# Test d'indépendance : autocorrélation des maxima mensuels
acf(maxima_mensuels$hauteur, 
    main = "Fonction d'autocorrélation des maxima mensuels")

```

# Analyse bivariée

```{r}

# Extraction des données
SA <- donneesVague$station1   # Lion
SB <- donneesVague$station9  # 61010

data_biv <- cbind(SA, SB)

summary(data_biv)
plot(data_biv, main = "Nuage de points entre les stations SA et SB", col = "darkblue")


```

```{r}

# Extraction des maxima annuels
dates_df_biv <- data.frame(
  date   = dates,
  SA     = donneesVague$station1,
  SB     = donneesVague$station9,
  annee  = year(dates)
)

# Maxima annuels
maxima_SA <- aggregate(SA ~ annee, data = dates_df_biv, FUN = max)$SA
maxima_SB <- aggregate(SB ~ annee, data = dates_df_biv, FUN = max)$SB

cat("Nombre de maxima annuels:", length(maxima_SA), "\n")

```

```{r}

mrlplot(maxima_SA)

```

```{r}

# Ajustement GEV (comme dans le TP)
gevSA <- fgev(maxima_SA)
gevSB <- fgev(maxima_SB)

gevSA
gevSB

```

```{r}

# Transformation (identique au TP lignes 282-283)
SA_F <- qgev(pgev(maxima_SA,
                  loc   = gevSA$estimate["loc"],
                  scale = gevSA$estimate["scale"],
                  shape = gevSA$estimate["shape"]),
             loc = 1, scale = 1, shape = 1)

SB_F <- qgev(pgev(maxima_SB,
                  loc   = gevSB$estimate["loc"],
                  scale = gevSB$estimate["scale"],
                  shape = gevSB$estimate["shape"]),
             loc = 1, scale = 1, shape = 1)

# Vérification : les marginales sont bien Fréchet(1,1,1)
fgev(SA_F)  # devrait donner loc≈1, scale≈1, shape≈1

```

```{r}

plot(SA_F, SB_F,
     main = "Données transformées en Fréchet unité",
     xlab = "SA - Fréchet(1,1,1)",
     ylab = "SB - Fréchet(1,1,1)",
     col  = "darkblue")

```

```{r}

# Chi-plot sur les maxima annuels (comme dans le TP)
chiplot(cbind(maxima_SA, maxima_SB),
        main1 = "Chi Plot - SA et SB",
        main2 = "Chi Bar Plot - SA et SB")

```

```{r}

# A(t) non paramétrique
abvnonpar(data = cbind(maxima_SA, maxima_SB), 
          plot = TRUE, 
          col = "brown")

abvnonpar(data = cbind(maxima_SA, maxima_SB), 
          plot = TRUE, 
          method = "pickands", 
          col = "tan", 
          add = TRUE)

# Légende
legend("bottomright",
       legend = c("CFG", "Pickands"),
       col = c("brown", "tan"),
       lwd = 2,
       bty = "n")

# Titre
title(main = "Estimation non paramétrique de la fonction A(t)",
      cex.main = 1.2)

# Coefficient d'extrémalité
theta <- 2 * abvnonpar(x = 0.5, cbind(maxima_SA, maxima_SB))
cat("Coefficient theta :", theta, "\n")

```

```{r}

# Modèle logistique
modlog <- fbvevd(cbind(SA_F, SB_F), model = "log")
modlog

```

```{r}

# Modèle asymétrique
modalog <- fbvevd(cbind(SA_F, SB_F), model = "alog")
modalog

```


```{r}

# Test de comparaison
anova(modalog, modlog)

```

# Partie b)

```{r}

# SA + station 8 (INDICE 6)

# Extraction des maxima annuels
SC <- donneesVague$station6
dates_df_proche <- data.frame(
  date   = dates,
  SA     = donneesVague$station1,
  SC     = SC,
  annee  = year(dates)
)

maxima_SC <- aggregate(SC ~ annee, data = dates_df_proche, FUN = max)$SC

# Ajustement GEV
gevSC <- fgev(maxima_SC)
gevSC

# Transformation Fréchet
SC_F <- qgev(pgev(maxima_SC,
                  loc   = gevSC$estimate["loc"],
                  scale = gevSC$estimate["scale"],
                  shape = gevSC$estimate["shape"]),
             loc = 1, scale = 1, shape = 1)

# Chi-plot
chiplot(cbind(SA_F, SC_F),
        main1 = "Chi Plot - SA et SC",
        main2 = "Chi Bar Plot - SA et SC")

# Coefficient theta
theta_SC <- 2 * abvnonpar(x = 0.5, cbind(SA_F, SC_F))
cat("Coefficient theta (SA-SC):", theta_SC, "\n")

# Modèle logistique
modlog_SC <- fbvevd(cbind(SA_F, SC_F), model = "log")
modlog_SC


```

```{r}

# SA + station 7 (INDICE 5)

# Extraction des maxima annuels
SD <- donneesVague$station5
dates_df_loin <- data.frame(
  date   = dates,
  SA     = donneesVague$station1,
  SD     = SD,
  annee  = year(dates)
)

maxima_SD <- aggregate(SD ~ annee, data = dates_df_loin, FUN = max)$SD

# Ajustement GEV
gevSD <- fgev(maxima_SD)
gevSD

# Transformation Fréchet
SD_F <- qgev(pgev(maxima_SD,
                  loc   = gevSD$estimate["loc"],
                  scale = gevSD$estimate["scale"],
                  shape = gevSD$estimate["shape"]),
             loc = 1, scale = 1, shape = 1)

# Chi-plot
chiplot(cbind(SA_F, SD_F),
        main1 = "Chi-plot - SA et SD (station éloignée)")

# Coefficient theta
theta_SD <- 2 * abvnonpar(x = 0.5, cbind(SA_F, SD_F))
cat("Coefficient theta (SA-SD):", theta_SD, "\n")

# Modèle logistique
modlog_SD <- fbvevd(cbind(SA_F, SD_F), model = "log")
modlog_SD

```

```{r}

# COMPARAISON SYNTHÉTIQUE

# Tableau comparatif des paramètres
comparaison <- data.frame(
  Paire = c("SA-SB (413 km)", "SA-SC (7 km)", "SA-SD (397 km)"),
  gamma_2 = c(gevSB$estimate["shape"], 
              gevSC$estimate["shape"], 
              gevSD$estimate["shape"]),
  alpha = c(modlog$estimate["dep"],
            modlog_SC$estimate["dep"],
            modlog_SD$estimate["dep"]),
  theta = c(theta, theta_SC, theta_SD)
)

print(comparaison)

```


```{r}

# Graphique comparatif des fonctions A(t)
par(mfrow = c(1, 1))

# SA-SC (proche, 7 km)
abvnonpar(data = cbind(maxima_SA, maxima_SC), plot = TRUE, 
          col = "lightblue", lwd = 2, 
          main = "Comparaison des fonctions A(t)")

# SA-SB (éloignée, 413 km)
abvnonpar(data = cbind(maxima_SA, maxima_SB), plot = TRUE, 
          col = "lightcoral", lwd = 2, add = TRUE)

# SA-SD (intermédiaire, 298 km)
abvnonpar(data = cbind(maxima_SA, maxima_SD), plot = TRUE, 
          col = "lightgreen", lwd = 2, add = TRUE)


# Légende
legend("bottomright", 
       legend = c("SA-SB", 
                  "SA-SC", 
                  "SA-SD"),
       col = c("lightcoral", "lightblue", "lightgreen"),
       lty = c(1, 1, 1),
       lwd = c(2, 2, 2),
       bty = "n")

```

```{r}

# Graphique comparatif
matplot(unique(dates_df_biv$annee), 
        cbind(maxima_SA, maxima_SB, maxima_SC, maxima_SD),
        type = "l", lty = 1, lwd = 2,
        col = c("purple", "lightcoral", "lightblue", "lightgreen"),
        xlab = "Année", ylab = "Hauteur maximale (m)",
        main = "Évolution des maxima annuels par station")
legend("topright", 
       legend = c("SA (Lion)", "SB (St11)", "SC (St8)", "SD (St7)"),
       col = c("purple", "lightcoral", "lightblue", "lightgreen"),
       lty = 1, lwd = 2)

```









